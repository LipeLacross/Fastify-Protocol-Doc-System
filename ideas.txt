
ğŸ“¦ Projeto: Sistema de Protocolo de Documentos com REST + GraphQL
Um sistema completo de backend utilizando Fastify + TypeScript, com upload de arquivos, autenticaÃ§Ã£o, histÃ³rico de alteraÃ§Ãµes e dois modos de acesso Ã  API: REST (para administraÃ§Ã£o) e GraphQL (para consulta pÃºblica).

ğŸ¯ Objetivo
Criar uma API moderna e robusta que permita:

Cadastrar documentos com nÃºmero de protocolo Ãºnico

Fazer upload de arquivos associados a esses documentos

Manter um histÃ³rico de alteraÃ§Ãµes de cada documento

Autenticar usuÃ¡rios com JWT

Permitir consulta pÃºblica via GraphQL

ğŸ§© MÃ³dulos principais
ğŸ” AutenticaÃ§Ã£o
Registro e login de usuÃ¡rios com email, senha, role (admin/user)

JWT com middleware de proteÃ§Ã£o para rotas privadas

ğŸ—ƒï¸ GestÃ£o de Documentos
CRUD de documentos via REST:

POST /documents (criaÃ§Ã£o + upload)

GET /documents/:id

PUT /documents/:id (ediÃ§Ã£o com log no histÃ³rico)

DELETE /documents/:id (opcional)

Campos de documento:

protocolo (gerado automaticamente, ex: DOC-2025001)

titulo, descricao, autor, arquivo, status

ğŸ“œ HistÃ³rico de AlteraÃ§Ãµes
Cada ediÃ§Ã£o registra:

UsuÃ¡rio que alterou

Campos modificados

Data da alteraÃ§Ã£o

Endpoint: GET /documents/:id/history

ğŸ“‚ Upload de Arquivos
Upload com fastify-multipart

Armazenamento:

Local (pasta uploads/) ou

Supabase (se desejar)

Rota de acesso aos arquivos via fastify-static

ğŸ“Š Consulta PÃºblica via GraphQL
Endpoint: /graphql

Permite consultas como:

graphql
Copy
Edit
query {
documents(status: "ativo") {
protocolo
titulo
autor
dataCriacao
}
}
Apenas leitura (sem autenticaÃ§Ã£o)

ğŸ› ï¸ Tecnologias
Fastify (com plugins como fastify-jwt, fastify-multipart, mercurius, fastify-static)

TypeScript

PostgreSQL (via Prisma ou TypeORM)

GraphQL com mercurius

Testes com Vitest ou tap

ğŸ—‚ï¸ Estrutura de pastas (sugestÃ£o)
pgsql
Copy
Edit
src/
â”œâ”€â”€ routes/
â”‚ â”œâ”€â”€ auth.routes.ts
â”‚ â”œâ”€â”€ documents.routes.ts
â”œâ”€â”€ controllers/
â”œâ”€â”€ services/
â”œâ”€â”€ schemas/
â”œâ”€â”€ graphql/
â”‚ â”œâ”€â”€ schema.gql
â”‚ â”œâ”€â”€ resolvers.ts
â”œâ”€â”€ plugins/
â”‚ â”œâ”€â”€ auth.ts
â”‚ â”œâ”€â”€ db.ts
â”‚ â”œâ”€â”€ graphql.ts
â”œâ”€â”€ uploads/
â”œâ”€â”€ prisma/ (ou ormconfig)
